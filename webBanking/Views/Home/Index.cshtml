
@model ChartDataViewModel
@{ ViewData["Title"] = "Home Page";}

<div class="text-center">
    <h1 class="display-4">Welcome To MCBA Bank</h1>

    @{
        var isLoggedIn = Context.Session.GetInt32(nameof(Customer.CustomerID)).HasValue;
    }
    @if (isLoggedIn)
    {
        <h3>Dashboard</h3>

        <div class="container">
            <div class="row">
                <div class="col" id="ColumnChart" style="width: 100%; height: 800px;"></div>
                <!--<div class="col">-->@* Add form to control chart *@<!--</div>-->
            </div>
            <div class="row">
                <div class="col" id="piechart" style="width: 900px; height: 500px;"></div>
                <!--<div class="col">-->@* Add form to control chart *@<!--</div>-->
            </div>
        </div>


    }
</div>


@if (isLoggedIn)
{
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);
        google.charts.setOnLoadCallback(drawChart2);

        function drawChart() {

            var data = google.visualization.arrayToDataTable([
                ['date', 'deposit', 'withdraw', 'service fee', 'Incoming Transfer', 'Outgoing Transfer', 'BillPay']
                @foreach (var item in Model.Transactions)
                {
                    @if (item.type == TransactionType.Deposit) {
                        <text>, [new Date('@item.date'), @item.amount,0,0,0,0,0]</text>}
                    @if (item.type == TransactionType.Withdraw) {
                        <text>, [new Date('@item.date'),0, -@item.amount,0,0,0,0]</text>}
                    @if (item.type == TransactionType.ServiceCharge) {
                        <text>, [new Date('@item.date'),0,0, -@item.amount,0,0,0]</text>}
                    @if (item.type == TransactionType.IncomingTransfer) {
                        <text>, [new Date('@item.date'),0,0,0, @item.amount,0,0]</text>}
                    @if (item.type == TransactionType.OutgoingTransfer) {
                        <text>, [new Date('@item.date'),0,0,0,0, -@item.amount,0]</text>}
                    @if (item.type == TransactionType.BillPay) {
                        <text>, [new Date('@item.date'),0,0,0,0,0, -@item.amount]</text>}


                }
            ]);

            var options = {
                title: 'Transaction Amounts For The Past 14 Days',
                vAxis:
                {
                    format: 'currency'
                },
                hAxis:
                {
                    format: 'd MMM'
                },
                bar:
                {
                    groupWidth: 200
                }

            };

            var chart = new google.visualization.ColumnChart(document.getElementById('ColumnChart'));

            chart.draw(data, options);
        }
        function drawChart2() {

            var data = google.visualization.arrayToDataTable([
                ['type','count']
                @foreach (var item in Model.TransactionsCount)
                {
                    <text>,['@item.type', @item.count]</text>
                }
            ]);

            var options = {
                title: 'Transaction Distrubution For The Past 14 Days'
            };

            var chart = new google.visualization.PieChart(document.getElementById('piechart'));

            chart.draw(data, options);
        }</script>
}